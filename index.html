<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ê—Ä–≥–æ–Ω ‚Äî –ñ–∏–≤–æ–π –ü–æ–º–æ—â–Ω–∏–∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* –ñ–∏–≤–æ–π —Ñ–æ–Ω */
        .ambient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.3;
        }

        .particle {
            position: absolute;
            background: rgba(100, 200, 255, 0.6);
            border-radius: 50%;
            animation: float 15s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
        #argon-container {
            position: absolute;
            width: 200px;
            height: 280px;
            cursor: grab;
            transition: transform 0.1s;
            z-index: 10;
            filter: drop-shadow(0 10px 30px rgba(0,150,255,0.3));
        }

        #argon-container:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        /* SVG –ü–µ—Ä—Å–æ–Ω–∞–∂ –ê—Ä–≥–æ–Ω */
        .argon-character {
            width: 100%;
            height: 100%;
        }

        /* –≠–º–æ—Ü–∏–∏ —á–µ—Ä–µ–∑ CSS-–∞–Ω–∏–º–∞—Ü–∏–∏ */
        .eye {
            animation: blink 4s infinite;
            transform-origin: center;
        }

        @keyframes blink {
            0%, 96%, 100% { transform: scaleY(1); }
            98% { transform: scaleY(0.1); }
        }

        .mouth {
            transition: all 0.3s ease;
        }

        .talking .mouth {
            animation: talk 0.3s infinite alternate;
        }

        @keyframes talk {
            0% { transform: scaleY(1); }
            100% { transform: scaleY(0.3); }
        }

        .happy .mouth {
            d: path("M 70 140 Q 100 160 130 140");
        }

        .thinking .eyebrow-left, .thinking .eyebrow-right {
            animation: think 2s infinite;
        }

        @keyframes think {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .surprised .eye {
            transform: scale(1.2);
        }

        .sleepy .eye {
            animation: sleep 3s infinite;
        }

        @keyframes sleep {
            0%, 90% { transform: scaleY(0.1); }
            95% { transform: scaleY(1); }
            100% { transform: scaleY(0.1); }
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 30px 30px 0 0;
            z-index: 100;
        }

        .wave-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .voice-wave {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 40px;
        }

        .wave-bar {
            width: 4px;
            background: linear-gradient(to top, #00d4ff, #0099ff);
            border-radius: 2px;
            transition: height 0.1s;
        }

        .mic-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #00d4ff, #0099ff);
            color: white;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,153,255,0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mic-btn:active {
            transform: scale(0.9);
        }

        .mic-btn.listening {
            background: linear-gradient(135deg, #ff4757, #ff6348);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,71,87,0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255,71,87,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,71,87,0); }
        }

        /* –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ */
        .dialog-box {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 50;
            transform: translateY(-120%);
            transition: transform 0.3s ease;
        }

        .dialog-box.active {
            transform: translateY(0);
        }

        .message {
            margin-bottom: 10px;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .user-msg {
            background: #e3f2fd;
            margin-left: auto;
            color: #1565c0;
        }

        .argon-msg {
            background: #f3e5f5;
            color: #6a1b9a;
        }

        .emotion-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 40px;
            z-index: 60;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 60;
            backdrop-filter: blur(10px);
        }

        .settings-panel {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(0,0,0,0.9);
            border-radius: 20px;
            padding: 20px;
            color: white;
            z-index: 70;
            display: none;
            min-width: 250px;
        }

        .settings-panel.active {
            display: block;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            opacity: 0.8;
        }

        input[type="range"] {
            width: 100%;
            accent-color: #00d4ff;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è */
        .mood-bar {
            position: fixed;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
        }

        .mood-item {
            font-size: 24px;
            opacity: 0.3;
            transition: all 0.3s;
            cursor: pointer;
        }

        .mood-item.active {
            opacity: 1;
            transform: scale(1.3);
        }

        /* –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –º—ã—Å–ª–∏ */
        .thought-bubble {
            position: absolute;
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
            max-width: 200px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s;
            pointer-events: none;
            z-index: 20;
        }

        .thought-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 30px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
        }

        .thought-bubble.show {
            opacity: 1;
            transform: scale(1);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥—ã—Ö–∞–Ω–∏—è */
        .breathing {
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }

        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-text {
            color: white;
            margin-top: 20px;
            font-size: 24px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px #00d4ff; }
            50% { text-shadow: 0 0 30px #00d4ff, 0 0 50px #0099ff; }
        }
    </style>
</head>
<body>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div class="loader" id="loader">
        <svg width="100" height="100" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="40" stroke="#00d4ff" stroke-width="4" fill="none" stroke-dasharray="60 200">
                <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="2s" repeatCount="indefinite"/>
            </circle>
        </svg>
        <div class="loader-text">–ê—Ä–≥–æ–Ω –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è...</div>
    </div>

    <!-- –§–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã -->
    <div class="ambient-bg" id="particles"></div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —ç–º–æ—Ü–∏–∏ -->
    <div class="emotion-indicator" id="emotion-indicator">üòê</div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
    <div class="settings-panel" id="settings">
        <div class="setting-item">
            <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å –≥–æ–ª–æ—Å–∞</label>
            <input type="range" id="volume" min="0" max="100" value="80">
        </div>
        <div class="setting-item">
            <label>–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏</label>
            <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
        </div>
        <div class="setting-item">
            <label>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–∞–≤—Ç–æ-–≤–æ–ø—Ä–æ—Å—ã)</label>
            <input type="range" id="activity" min="0" max="100" value="50">
        </div>
    </div>

    <!-- –î–∏–∞–ª–æ–≥ -->
    <div class="dialog-box" id="dialog">
        <div id="messages"></div>
    </div>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂ –ê—Ä–≥–æ–Ω -->
    <div id="argon-container" class="breathing">
        <div class="thought-bubble" id="thought"></div>
        <svg class="argon-character" viewBox="0 0 200 280" id="argon">
            <!-- –¢–µ–ª–æ/–ø–ª–∞—â -->
            <path d="M 50 200 Q 20 250 30 280 L 170 280 Q 180 250 150 200" fill="url(#bodyGradient)" opacity="0.9"/>
            <defs>
                <linearGradient id="bodyGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#4fc3f7;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#0288d1;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="faceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#e1f5fe;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#b3e5fc;stop-opacity:1" />
                </linearGradient>
            </defs>
            
            <!-- –ì–æ–ª–æ–≤–∞ -->
            <ellipse cx="100" cy="100" rx="60" ry="70" fill="url(#faceGradient)" stroke="#81d4fa" stroke-width="2"/>
            
            <!-- –í–æ–ª–æ—Å—ã/–∞–Ω—Ç–µ–Ω–Ω—ã -->
            <path d="M 40 60 Q 30 20 50 40" stroke="#0288d1" stroke-width="3" fill="none" class="antenna"/>
            <path d="M 160 60 Q 170 20 150 40" stroke="#0288d1" stroke-width="3" fill="none" class="antenna"/>
            <circle cx="50" cy="40" r="5" fill="#00d4ff" class="antenna-tip">
                <animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/>
            </circle>
            <circle cx="150" cy="40" r="5" fill="#00d4ff" class="antenna-tip">
                <animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/>
            </circle>
            
            <!-- –ì–ª–∞–∑–∞ -->
            <g class="eye-group">
                <ellipse class="eye" cx="75" cy="90" rx="12" ry="15" fill="#333"/>
                <ellipse class="eye" cx="125" cy="90" rx="12" ry="15" fill="#333"/>
                <circle cx="78" cy="85" r="4" fill="white"/>
                <circle cx="128" cy="85" r="4" fill="white"/>
            </g>
            
            <!-- –ë—Ä–æ–≤–∏ -->
            <path class="eyebrow-left" d="M 60 70 Q 75 65 90 70" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
            <path class="eyebrow-right" d="M 110 70 Q 125 65 140 70" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
            
            <!-- –†–æ—Ç -->
            <path class="mouth" d="M 85 130 Q 100 140 115 130" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
            
            <!-- –†—É–º—è–Ω–µ—Ü -->
            <ellipse cx="60" cy="110" rx="8" ry="5" fill="#ff8a80" opacity="0.3"/>
            <ellipse cx="140" cy="110" rx="8" ry="5" fill="#ff8a80" opacity="0.3"/>
            
            <!-- –¢–µ–Ω—å -->
            <ellipse cx="100" cy="275" rx="70" ry="10" fill="rgba(0,0,0,0.2)"/>
        </svg>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è -->
    <div class="mood-bar">
        <span class="mood-item" data-mood="happy" onclick="setMood('happy')">üòä</span>
        <span class="mood-item" data-mood="sad" onclick="setMood('sad')">üò¢</span>
        <span class="mood-item" data-mood="angry" onclick="setMood('angry')">üò†</span>
        <span class="mood-item" data-mood="surprised" onclick="setMood('surprised')">üò≤</span>
        <span class="mood-item active" data-mood="neutral" onclick="setMood('neutral')">üòê</span>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="control-panel">
        <div class="wave-container">
            <div class="voice-wave" id="wave">
                <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è JS -->
            </div>
            <button class="mic-btn" id="mic" onclick="toggleListening()">üé§</button>
        </div>
        <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 12px;">
            –ù–∞–∂–º–∏ –∏ –≥–æ–≤–æ—Ä–∏ ‚Ä¢ –¢—è–Ω–∏ –ê—Ä–≥–æ–Ω–∞ –∑–∞ —Ä—É–∫—É
        </div>
    </div>

    <script>
        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        const argon = document.getElementById('argon-container');
        const thought = document.getElementById('thought');
        const dialog = document.getElementById('dialog');
        const messages = document.getElementById('messages');
        const micBtn = document.getElementById('mic');
        const emotionIndicator = document.getElementById('emotion-indicator');
        
        let isListening = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;
        let currentEmotion = 'neutral';
        let autonomyInterval = null;
        let position = { x: window.innerWidth/2 - 100, y: window.innerHeight/2 - 140 };
        let velocity = { x: 0, y: 0 };
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        // ===== –ù–ê–°–¢–†–û–ô–ö–ê –ì–û–õ–û–°–û–í–û–ì–û –£–ü–†–ê–í–õ–ï–ù–ò–Ø =====
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'ru-RU';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                isListening = true;
                micBtn.classList.add('listening');
                micBtn.textContent = 'üî¥';
                setEmotion('listening');
            };

            recognition.onend = () => {
                isListening = false;
                micBtn.classList.remove('listening');
                micBtn.textContent = 'üé§';
            };

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                addMessage(text, 'user');
                processCommand(text);
            };

            recognition.onerror = () => {
                speak('–ù–µ —Ä–∞—Å—Å–ª—ã—à–∞–ª, –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞');
            };
        }

        // ===== –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï –ü–ï–†–°–û–ù–ê–ñ–ê =====
        function updatePosition() {
            if (!isDragging) {
                // –§–∏–∑–∏–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
                position.x += velocity.x;
                position.y += velocity.y;
                
                // –¢—Ä–µ–Ω–∏–µ
                velocity.x *= 0.95;
                velocity.y *= 0.95;
                
                // –ì—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
                if (position.x < 0) { position.x = 0; velocity.x *= -0.5; }
                if (position.x > window.innerWidth - 200) { position.x = window.innerWidth - 200; velocity.x *= -0.5; }
                if (position.y < 50) { position.y = 50; velocity.y *= -0.5; }
                if (position.y > window.innerHeight - 350) { position.y = window.innerHeight - 350; velocity.y *= -0.5; }
                
                // –°–ª—É—á–∞–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (—Å–∫–∏—Ç–∞–Ω–∏–µ)
                if (Math.abs(velocity.x) < 0.1 && Math.abs(velocity.y) < 0.1 && Math.random() < 0.01) {
                    velocity.x = (Math.random() - 0.5) * 4;
                    velocity.y = (Math.random() - 0.5) * 4;
                }
            }
            
            argon.style.left = position.x + 'px';
            argon.style.top = position.y + 'px';
            requestAnimationFrame(updatePosition);
        }

        // Drag and drop
        argon.addEventListener('touchstart', handleStart);
        argon.addEventListener('mousedown', handleStart);
        
        function handleStart(e) {
            isDragging = true;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            dragOffset.x = clientX - position.x;
            dragOffset.y = clientY - position.y;
            
            // –†–µ–∞–∫—Ü–∏—è –Ω–∞ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–µ
            setEmotion('happy');
            speak('–û, –ø—Ä–∏–≤–µ—Ç!');
        }

        document.addEventListener('touchmove', handleMove);
        document.addEventListener('mousemove', handleMove);
        
        function handleMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const newX = clientX - dragOffset.x;
            const newY = clientY - dragOffset.y;
            
            velocity.x = (newX - position.x) * 0.3;
            velocity.y = (newY - position.y) * 0.3;
            
            position.x = newX;
            position.y = newY;
        }

        document.addEventListener('touchend', handleEnd);
        document.addEventListener('mouseup', handleEnd);
        
        function handleEnd() {
            isDragging = false;
        }

        // ===== –≠–ú–û–¶–ò–ò =====
        function setEmotion(emotion) {
            currentEmotion = emotion;
            argon.className = 'breathing';
            
            const emotions = {
                happy: { class: 'happy', emoji: 'üòä', color: '#4caf50' },
                sad: { class: 'sad', emoji: 'üò¢', color: '#2196f3' },
                angry: { class: 'angry', emoji: 'üò†', color: '#f44336' },
                surprised: { class: 'surprised', emoji: 'üò≤', color: '#ff9800' },
                thinking: { class: 'thinking', emoji: 'ü§î', color: '#9c27b0' },
                sleepy: { class: 'sleepy', emoji: 'üò¥', color: '#607d8b' },
                listening: { class: '', emoji: 'üëÇ', color: '#00d4ff' },
                neutral: { class: '', emoji: 'üòê', color: '#9e9e9e' }
            };
            
            const e = emotions[emotion];
            if (e.class) argon.classList.add(e.class);
            emotionIndicator.textContent = e.emoji;
            emotionIndicator.style.color = e.color;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
            document.querySelectorAll('.mood-item').forEach(item => {
                item.classList.toggle('active', item.dataset.mood === emotion);
            });
        }

        function setMood(mood) {
            setEmotion(mood);
            const responses = {
                happy: '–ö–ª–∞—Å—Å–Ω–æ, —á—Ç–æ —Ç—ã –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏!',
                sad: '–ù–µ –≥—Ä—É—Å—Ç–∏, –≤—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ!',
                angry: '–î–∞–≤–∞–π —É—Å–ø–æ–∫–æ–∏–º—Å—è, —è —Ä—è–¥–æ–º',
                surprised: '–û–≥–æ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?',
                neutral: '–ü–æ–Ω—è–ª —Ç–µ–±—è'
            };
            speak(responses[mood]);
        }

        // ===== –ì–û–õ–û–°–û–í–û–ô –í–í–û–î/–í–´–í–û–î =====
        function toggleListening() {
            if (!recognition) {
                speak('–ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function speak(text) {
            addMessage(text, 'argon');
            
            if (!synthesis) return;
            
            synthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU';
            utterance.rate = document.getElementById('rate').value;
            utterance.volume = document.getElementById('volume').value / 100;
            utterance.pitch = 1.1; // –ß—É—Ç—å –≤—ã—à–µ –¥–ª—è "–∂–∏–≤–æ—Å—Ç–∏"
            
            utterance.onstart = () => {
                argon.classList.add('talking');
                setEmotion('happy');
            };
            
            utterance.onend = () => {
                argon.classList.remove('talking');
                setEmotion('neutral');
            };
            
            synthesis.speak(utterance);
        }

        // ===== –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ú–ê–ù–î =====
        function processCommand(text) {
            const lower = text.toLowerCase();
            setEmotion('thinking');
            
            setTimeout(() => {
                if (lower.includes('–ø—Ä–∏–≤–µ—Ç') || lower.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π')) {
                    speak('–ü—Ä–∏–≤–µ—Ç! –Ø –ê—Ä–≥–æ–Ω, —Ç–≤–æ–π –∂–∏–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫. –ö–∞–∫ –¥–µ–ª–∞?');
                    setEmotion('happy');
                }
                else if (lower.includes('–∫–∞–∫ –¥–µ–ª–∞') || lower.includes('–∫–∞–∫ —Ç—ã')) {
                    const states = ['–û—Ç–ª–∏—á–Ω–æ!', '–í –ø–æ–ª–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!', '–ó–∞—Ä—è–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å!'];
                    speak(states[Math.floor(Math.random() * states.length)]);
                }
                else if (lower.includes('–ø–æ–≥–æ–¥–∞')) {
                    getWeather();
                }
                else if (lower.includes('–≤—Ä–µ–º—è') || lower.includes('—á–∞—Å')) {
                    const now = new Date();
                    speak(`–°–µ–π—á–∞—Å ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`);
                }
                else if (lower.includes('—à—É—Ç–∫') || lower.includes('–∞–Ω–µ–∫–¥–æ—Ç')) {
                    tellJoke();
                }
                else if (lower.includes('–ø–æ–∫–∞') || lower.includes('–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è')) {
                    speak('–ü–æ–∫–∞! –ë—É–¥—É —Å–∫—É—á–∞—Ç—å!');
                    setEmotion('sad');
                }
                else if (lower.includes('–ø–æ–º–æ–≥–∏') || lower.includes('—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å')) {
                    speak('–Ø —É–º–µ—é: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–≥–æ–¥—É, –≥–æ–≤–æ—Ä–∏—Ç—å –≤—Ä–µ–º—è, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å —à—É—Ç–∫–∏, —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —ç–º–æ—Ü–∏–∏ –∏ –ø—Ä–æ—Å—Ç–æ –±–æ–ª—Ç–∞—Ç—å. –ï—â—ë —è –º–æ–≥—É —Å–∞–º –∑–∞–≤–æ–¥–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä!');
                }
                else {
                    // –û—Ç–≤–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å "–ª–∏—á–Ω–æ—Å—Ç—å—é"
                    const defaults = [
                        '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ',
                        '–ü–æ–Ω–∏–º–∞—é —Ç–µ–±—è',
                        '–≠—Ç–æ –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ!',
                        '–Ø –æ–± —ç—Ç–æ–º –ø–æ–¥—É–º–∞—é',
                        '–ó–≤—É—á–∏—Ç –∑–¥–æ—Ä–æ–≤–æ!'
                    ];
                    speak(defaults[Math.floor(Math.random() * defaults.length)]);
                }
            }, 500);
        }

        // ===== –§–£–ù–ö–¶–ò–ò –ü–û–ú–û–©–ù–ò–ö–ê =====
        async function getWeather() {
            speak('–°–µ–π—á–∞—Å —É–∑–Ω–∞—é –ø–æ–≥–æ–¥—É...');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã API –∑–∞–ø—Ä–æ—Å)
            setTimeout(() => {
                const weathers = [
                    '–°–µ–≥–æ–¥–Ω—è —Å–æ–ª–Ω–µ—á–Ω–æ, –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏!',
                    '–ù–µ–º–Ω–æ–≥–æ –æ–±–ª–∞—á–Ω–æ, –Ω–æ —Ç–µ–ø–ª–æ',
                    '–°–≤–µ–∂–æ –∏ —è—Å–Ω–æ, –Ω–∞–¥–µ–≤–∞–π –∫–æ—Ñ—Ç—É',
                    '–í–æ–∑–º–æ–∂–µ–Ω –¥–æ–∂–¥–∏–∫, –≤–æ–∑—å–º–∏ –∑–æ–Ω—Ç –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π'
                ];
                speak(weathers[Math.floor(Math.random() * weathers.length)]);
            }, 1500);
        }

        function tellJoke() {
            const jokes = [
                '–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—É—Ç–∞—é—Ç –•—ç–ª–ª–æ—É–∏–Ω –∏ –†–æ–∂–¥–µ—Å—Ç–≤–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ 31 OCT = 25 DEC',
                '–®—Ç–∏—Ä–ª–∏—Ü –¥–æ–ª–≥–æ —Å–º–æ—Ç—Ä–µ–ª –≤ –∑–µ—Ä–∫–∞–ª–æ. –ù–µ —É–∑–Ω–∞–ª. –ü–æ—Å–º–æ—Ç—Ä–µ–ª —Å –ø–æ–¥–ø–∏—Å—å—é ‚Äî —É–∑–Ω–∞–ª',
                '–ó–∞—Ö–æ–¥–∏—Ç —É–ª–∏—Ç–∫–∞ –≤ –±–∞—Ä –∏ –≥–æ–≤–æ—Ä–∏—Ç: –ú–Ω–µ –≤–∏—Å–∫–∏. –ë–∞—Ä–º–µ–Ω: –£ –Ω–∞—Å –¥–ª—è —É–ª–∏—Ç–æ–∫ –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ–º. –£–ª–∏—Ç–∫–∞: –î–∞ –ª–∞–¥–Ω–æ, –Ω—É –ø–æ–∂–∞–ª—É–π—Å—Ç–∞!',
                '–ö–æ–ª–æ–±–æ–∫ –ø–æ–≤–µ—Å–∏–ª—Å—è. –≠—Ç–æ –±—ã–ª–∞ –Ω–µ —É–ª–∏–∫–∞, –∞ –ø–æ–Ω—á–∏–∫'
            ];
            speak(jokes[Math.floor(Math.random() * jokes.length)]);
            setEmotion('happy');
        }

        // ===== –ê–í–¢–û–ù–û–ú–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï =====
        function startAutonomy() {
            const thoughts = [
                '–ö–∞–∫–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –ø–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è!',
                '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?',
                '–ú–æ–∂–µ—Ç, —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∞–Ω–µ–∫–¥–æ—Ç?',
                '–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Ç–∞–∫–∏–º –∂–∏–≤—ã–º!',
                '–ù–∞–¥–æ –±—ã –ø–æ—Ç—è–Ω—É—Ç—å—Å—è...',
                '–•–º, —á—Ç–æ –±—ã —Ç–∞–∫–æ–µ —Å–ø—Ä–æ—Å–∏—Ç—å?'
            ];
            
            const questions = [
                '–ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–≤–æ–π –¥–µ–Ω—å?',
                '–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?',
                '–£ —Ç–µ–±—è –µ—Å—Ç—å –ø–ª–∞–Ω—ã –Ω–∞ –≤–µ—á–µ—Ä?',
                '–ö–∞–∫–æ–µ —É —Ç–µ–±—è –ª—é–±–∏–º–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞?',
                '–¢—ã –ª—é–±–∏—à—å –∫–æ—Ñ–µ –∏–ª–∏ —á–∞–π?'
            ];
            
            autonomyInterval = setInterval(() => {
                const activity = document.getElementById('activity').value;
                if (Math.random() > activity / 100) return;
                
                if (Math.random() > 0.5) {
                    // –ü–æ–∫–∞–∑–∞—Ç—å –º—ã—Å–ª—å
                    thought.textContent = thoughts[Math.floor(Math.random() * thoughts.length)];
                    thought.classList.add('show');
                    setTimeout(() => thought.classList.remove('show'), 3000);
                } else {
                    // –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
                    speak(questions[Math.floor(Math.random() * questions.length)]);
                }
            }, 15000); // –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞
        }

        // ===== –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –ì–û–õ–û–°–ê =====
        function createWave() {
            const wave = document.getElementById('wave');
            for (let i = 0; i < 8; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.height = '10px';
                wave.appendChild(bar);
            }
            
            setInterval(() => {
                const bars = wave.querySelectorAll('.wave-bar');
                bars.forEach(bar => {
                    const height = isListening ? 
                        Math.random() * 30 + 10 : 
                        5 + Math.sin(Date.now() / 500 + Math.random()) * 3;
                    bar.style.height = height + 'px';
                });
            }, 100);
        }

        // ===== –î–ò–ê–õ–û–ì =====
        function addMessage(text, sender) {
            const msg = document.createElement('div');
            msg.className = `message ${sender}-msg`;
            msg.textContent = text;
            messages.appendChild(msg);
            dialog.classList.add('active');
            messages.scrollTop = messages.scrollHeight;
            
            // –ê–≤—Ç–æ-—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (messages.children.length === 1) {
                    dialog.classList.remove('active');
                }
                msg.remove();
            }, 10000);
        }

        // ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
        function toggleSettings() {
            document.getElementById('settings').classList.toggle('active');
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        window.onload = () => {
            // –°–æ–∑–¥–∞—Ç—å —á–∞—Å—Ç–∏—Ü—ã
            const particles = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.width = p.style.height = Math.random() * 4 + 2 + 'px';
                p.style.animationDelay = Math.random() * 15 + 's';
                p.style.animationDuration = (10 + Math.random() * 10) + 's';
                particles.appendChild(p);
            }
            
            createWave();
            updatePosition();
            startAutonomy();
            
            // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            setTimeout(() => {
                document.getElementById('loader').classList.add('hidden');
                speak('–ü—Ä–∏–≤–µ—Ç! –Ø –ê—Ä–≥–æ–Ω! –¢—ã –º–æ–∂–µ—à—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å –º–µ–Ω—è –ø–æ —ç–∫—Ä–∞–Ω—É, –≥–æ–≤–æ—Ä–∏—Ç—å —Å–æ –º–Ω–æ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–ª—é–¥–∞—Ç—å, –∫–∞–∫ —è –∂–∏–≤—É —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é!');
            }, 2000);
        };

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchmove', (e) => {
            if (e.target.closest('#argon-container')) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
